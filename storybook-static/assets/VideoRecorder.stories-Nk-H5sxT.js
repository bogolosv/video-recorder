import{j as t}from"./jsx-runtime-DWbWqHZ-.js";import{r as o}from"./index-l2PZgWEW.js";import{B as O}from"./BaseVideo-BCRQAMYp.js";import{R as N}from"./RecordingButton-CsMeXrWg.js";import{F as d}from"./FlexBox-B1-whqXL.js";import{u as L}from"./useVideoContainerSettings-Rlb4ApIP.js";import{V as g}from"./VideoRecorderButton-DbZG05gG.js";import{PauseIcon as q}from"./PauseIcon-BiodG7g_.js";import{PlayIcon as z}from"./PlayIcon-D7z0okfG.js";import{MicrophoneMutedIcon as X}from"./MicrophoneMutedIcon-C96_MmUd.js";import{MicrophoneIcon as Y}from"./MicrophoneIcon-C4dd8OmY.js";import{PhotoIcon as G}from"./PhotoIcon-oyIR5Hsv.js";import{ToolsIcon as J}from"./ToolsIcon-nkm4hPjb.js";import{P as b}from"./Popover-Dh36k8FL.js";import{B as S}from"./Button-DKsU6LIg.js";import{u as Q}from"./useMessageContext-3Q3LaL_c.js";import{S as Z}from"./Span-BESuZiTl.js";import"./index-B_cAd6g5.js";import"./StopRecordIcon-Ck4h_tsh.js";import"./assertThisInitialized-Cfdbw4yV.js";import"./index-BtTJd_qj.js";import"./objectWithoutPropertiesLoose-CAYKN5F1.js";import"./isNativeReflectConstruct-gwnEYaHE.js";import"./wrapNativeSuper-DYpslqgs.js";import"./const-BFbRbAgg.js";const $="_recorderContainer_w3u8q_1",W="_recordingUtilsContainer_w3u8q_5",ee="_headerContainer_w3u8q_11",y={recorderContainer:$,recordingUtilsContainer:W,headerContainer:ee};var a=(e=>(e.SD="SD",e.HD="HD",e.FullHD="Full HD",e.FullHDUltra="Full HD Ultra",e.TwoK="2K",e.FourK="4K",e.EightK="8K",e))(a||{});function te(e,r){const s=[];return e>=640&&r>=480&&s.push("SD"),e>=1280&&r>=720&&s.push("HD"),e>=1920&&r>=1080&&s.push("Full HD"),e>=1920&&r>=1440&&s.push("Full HD Ultra"),e>=2560&&r>=1440&&s.push("2K"),e>=3840&&r>=2160&&s.push("4K"),e>=7680&&r>=4320&&s.push("8K"),s}const re={[a.SD]:{width:640,height:480},[a.HD]:{width:1280,height:720},[a.FullHD]:{width:1920,height:1080},[a.FullHDUltra]:{width:1920,height:1440},[a.TwoK]:{width:2560,height:1440},[a.FourK]:{width:3840,height:2160},[a.EightK]:{width:7680,height:4320}},oe=e=>{const r=document.createElement("canvas"),s=r.getContext("2d");return s?(r.width=e.videoWidth,r.height=e.videoHeight,s.drawImage(e,0,0,r.width,r.height),r.toDataURL("image/png")):""};function ne(e){const r=atob(e.split(",")[1]),s=e.split(",")[0].split(":")[1].split(";")[0],p=new ArrayBuffer(r.length),f=new Uint8Array(p);for(let c=0;c<r.length;c++)f[c]=r.charCodeAt(c);return new Blob([p],{type:s})}const R=o.createContext(void 0);function se(){return o.useContext(R)}const U=o.forwardRef((e,r)=>{var _;const{openMessage:s}=Q(),[p,f]=o.useState(!1),[c,m]=o.useState(!1),[u,I]=o.useState([]),[h,k]=o.useState(a.FullHD),i=o.useRef(null),{audioInputs:ae,videoInputs:K,audioOutputs:ce}=se(),[v,H]=o.useState();o.useImperativeHandle(r,()=>i.current,[i.current]),L(((_=i.current)==null?void 0:_.container)??null);const A=o.useCallback(()=>{f(n=>!n)},[]),T=o.useCallback(()=>{m(n=>!n)},[]),P=o.useCallback(n=>{n.stopPropagation()},[]);o.useEffect(()=>{if(!i.current)return;const n={deviceId:(v==null?void 0:v.deviceId)??"default",...re[h]};(async()=>{var C,D;try{const w=await navigator.mediaDevices.getUserMedia({video:n});i.current&&(i.current.video.srcObject=w);const x=w.getVideoTracks()[0].getCapabilities();(C=x.width)!=null&&C.max&&((D=x.height)!=null&&D.max)&&I(te(x.width.max,x.height.max))}catch(w){console.log("Access denied",w)}})()},[i.current,v,h]);const V=o.useCallback(async n=>{if(!i.current)return;const l=oe(i.current.video),C=ne(l);if(navigator.clipboard&&navigator.clipboard.write){const D=new ClipboardItem({"image/png":C});await navigator.clipboard.write([D]),s(t.jsxs(d,{column:!0,align:"middle",gap:"small",children:[t.jsx(Z,{children:"Copied!"}),t.jsx("img",{src:l,alt:"",style:{width:"200px"}})]}),n)}},[]);return t.jsxs(O,{ref:i,className:y.recorderContainer,autoPlay:!0,style:{transform:"scaleX(-1)"},children:[t.jsx(d,{justify:"space-between",align:"middle",gap:"small",className:y.headerContainer,onClick:P,children:t.jsx(b,{content:t.jsx(d,{column:!0,children:u.map(n=>{const l=()=>{k(n)};return t.jsx(S,{size:"small",primary:n===h,onClick:l,children:n},n)})}),children:t.jsx(g,{children:h})})}),t.jsxs(d,{justify:"space-between",align:"middle",gap:"small",className:y.recordingUtilsContainer,onClick:P,children:[t.jsx(g,{Icon:G,onClick:V}),t.jsxs(d,{justify:"space-between",align:"middle",gap:"small",children:[t.jsx(g,{Icon:p?z:q,onClick:A}),t.jsx(N,{}),t.jsx(g,{Icon:c?X:Y,onClick:T})]}),t.jsx(b,{content:t.jsx(d,{column:!0,children:t.jsx(b,{content:t.jsx(d,{column:!0,children:K.map(n=>{const l=()=>{H(n)};return t.jsx(S,{onClick:l,children:n.label},n.deviceId)})}),children:t.jsx(S,{children:"Video"})})}),children:t.jsx(g,{Icon:J})})]})]})});U.__docgenInfo={description:"",methods:[],displayName:"VideoRecorder"};const ie=()=>{const[e,r]=o.useState([]),[s,p]=o.useState([]),[f,c]=o.useState([]),m=o.useCallback(async()=>{const u=await navigator.mediaDevices.enumerateDevices(),I=u.filter(i=>i.kind==="audioinput"),h=u.filter(i=>i.kind==="audiooutput"),k=u.filter(i=>i.kind==="videoinput");r(I),c(k),p(h)},[]);return o.useEffect(()=>{const u=async()=>{await m()};return navigator.mediaDevices.addEventListener("devicechange",u),()=>{navigator.mediaDevices.removeEventListener("devicechange",u)}},[m]),o.useEffect(()=>{m()},[m]),{videoInputs:f,audioInputs:e,audioOutputs:s}},E=({children:e})=>{const r=ie();return t.jsx(R.Provider,{value:r,children:e})};E.__docgenInfo={description:"",methods:[],displayName:"MediaDevicesProvider",props:{children:{required:!0,tsType:{name:"ReactNode"},description:""}}};const Ee={title:"Components/Video Recorder",component:U,decorators:[e=>t.jsx(E,{children:t.jsx(e,{})})],parameters:{layout:"centered"},tags:["autodocs"]},j={name:"Default",args:{}};var B,F,M;j.parameters={...j.parameters,docs:{...(B=j.parameters)==null?void 0:B.docs,source:{originalSource:`{
  name: "Default",
  args: {}
}`,...(M=(F=j.parameters)==null?void 0:F.docs)==null?void 0:M.source}}};const Ke=["DefaultRecordButtonStory"];export{j as DefaultRecordButtonStory,Ke as __namedExportsOrder,Ee as default};
